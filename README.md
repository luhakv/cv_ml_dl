# Проект 8. Возьмёте Бэтмобиль?   
##  Юнит 9. NLP/Computer Vision   
### skillfactory_rds  
![https://img.shields.io/badge/Python-3.8.5-blue](https://img.shields.io/badge/Python-3.8.5-blue)

## Оглавление  
[1. Описание проекта](https://github.com/alex-sokolov2011/skillfactory_rds/blob/master/module_7/README.md#Описание-проекта)  
[2. Какой кейс решаем?](https://github.com/alex-sokolov2011/skillfactory_rds/blob/master/module_7/README.md#Какой-кейс-решаем)  
[3. Краткая информация о данных](https://github.com/alex-sokolov2011/skillfactory_rds/blob/master/module_7/README.md#Краткая-информация-о-данных)  
[4. Этапы работы над проектом](https://github.com/alex-sokolov2011/skillfactory_rds/blob/master/module_7/README.md#Этапы-работы-над-проектом)  
[5. Результат](https://github.com/alex-sokolov2011/skillfactory_rds/blob/master/module_7/README.md#Результат)  

### Описание проекта  
За последние несколько месяцев работы в компании «Старый друг», которая занимается продажей автомобилей с пробегом в Москве, вы разработали две модели, которые уже успешно крутятся в продакшне и приносят деньги компании и радость сотрудникам (по словам Анны из отдела продаж).

Осталось довести свою работу до логичного завершения и, обогатив датасет текстовыми данными из объявлений о продаже, свести все наши модели в единое решение — Multi-inputs сеть.  

***Чем мы будем заниматься?***  

- Построим «наивную» ML-модель на табличных данных, которая предсказывает цену по модели и году выпуска. Это позволит нам задать направление для дальнейших экспериментов. Впоследствии, на этом этапе, вы можете доработать вашу модель из проекта «Выбираем авто выгодно».  
- Обработаем и отнормируем признаки и сделаем первую модель на основе градиентного бустинга с помощью CatBoost.
- Решим эту же задачу с помощью DL (модель NN Tabular) и сравним результаты.
- Добавим текстовые данные (NLP) и сделаем Multi-Input нейронную сеть для анализа и табличных данных, и текста одновременно.
- Добавим обработку изображений в Multi-Input нейронную сеть.
- Осуществим ансамблирование градиентного бустинга и нейронной сети (усредним их предсказания).  
:arrow_up:[к оглавлению](https://github.com/alex-sokolov2011/skillfactory_rds/blob/master/module_7/README.md#Оглавление)

### Какой кейс решаем?
Продолжение соревнования на Прогнозирование стоимости автомобиля, но уже с дополнительными данными.

Вам поставлена задача создать модель, которая будет предсказывать стоимость автомобиля.
Если наша модель работает хорошо, то мы сможем быстро выявлять выгодные предложения (когда желаемая цена продавца ниже предсказанной рыночной цены). Это значительно ускорит работу менеджеров и повысит прибыль компании.  

**Условия соревнования:**  
[Ссылка на закрытое соревнование](https://www.kaggle.com/c/sf-dst-car-price-prediction-part2)  

- Данное соревнование является бессрочным и доступно для всех потоков.
- Срок выполнения соревнования - с 10 по 17 февраля 2021.
- Тестовая выборка представлена в ЛидерБорде целиком. По этому лучшие и победные решения буду проверяться на их "адекватность" (чтоб не было подгонки под тестовую выборку).
- Разрешено использовать внешние данные. (но их источник должен быть публичным и доступен всем участникам соревнования)
- Разрешено использовать любые ML и DL алгоритмы и библиотеки.
- Даже если удасться найти исходные объявления из теста - нельзя просто указать их цену. Делаем реальный продукт, который потом сможет нормально работать на новых данных.


**Метрика качества**
Результаты оцениваются по метрике MAPE.  
MAPE  (Mean Absolute Percentage Error) расшифровывается выражение как средняя абсолютная ошибка в процентах.  
<img src="https://latex.codecogs.com/png.latex?\large&space;MAPE=\frac{1}{n}\sum_{t=1}^{n}\frac{\left&space;|&space;Y_t-\hat{Y_t}&space;\right&space;|}{Y_t}" title="\large MAPE=\frac{1}{n}\sum_{t=1}^{n}\frac{\left | Y_t-\hat{Y_t} \right |}{Y_t}" />
,  
где:  
- Y_t — фактическое значение целевого вектора;  
- Y_t_hat — вектор предсказания целевого значения;  
- n — количество значений в векторе целевой переменной  
:arrow_up:[к оглавлению](https://github.com/alex-sokolov2011/skillfactory_rds/blob/master/module_7/README.md#Оглавление)

### Краткая информация о данных

- train.csv - тренировочный датасет
- test.csv - тестовый датасет
- sample_submission.csv - пример правильного формата submission file
- img.zip - архив базы фотографий авто  
:arrow_up:[к оглавлению](https://github.com/alex-sokolov2011/skillfactory_rds/blob/master/module_7/README.md#Оглавление)

### Этапы работы над проектом  

- провел EDA (очиcтил датасет от выбросов,сгенерил новые признаки и отобрал удачные для построения модели, выполнил нормализацию и стандартизацию некоторых признаков, применил методы для кодирования категориальных признаков).
- построим «наивную» ML-модель на табличных данных.
- потом сделал модель на основе градиентного бустинга с помощью CatBoost.
- решил задачу с помощью DL (модель NN Tabular)
- построил модель по обработке естественного языка (NLP) (сначала применил стандартные архитектуры,потом применил Transfer-Learning и Fine-Tuning, применил дополнительные методы предобработки текста - лемматизация).
- потом добавил текстовые данные (NLP) и сделал Multi-Input нейронную сеть для анализа и табличных данных, и текста одновременно
- в конце добавил изображения в Multi-Input нейронную сеть, но это не дало прироста в скор (использовал EfficientNetB3, LR-Cycle) и конечно применял дополнительный метод предобработки изображений - аугментацию.
- применил метод проброса критерия, но прироста это не дало
- использовал ансамблирование градиентного бустинга и нейронной сети - этот метод дал лучший результат  
:arrow_up:[к оглавлению](https://github.com/alex-sokolov2011/skillfactory_rds/blob/master/module_7/README.md#Оглавление)

### Результаты:  
- score на kaggle = 11.11494 (5 место)
- проект выполнен в двух ноутбуках:
  - [ноутбук с EDA и препроцессингом табличных данных](https://www.kaggle.com/sokolovaleks/sf-dst-10-car-price-predic-part2-EDA-sokolov). Результатом этого ноутбука является датасет, который используется вторым (основным) ноутбуком.
  - [основной ноутбук с построением моделей на табличных данных, препроцессингом изображений и Multi-Input нейронной сетью](https://www.kaggle.com/sokolovaleks/sf-dst-10-car-price-prediction-part2-sokolov)  


К сожалению не хватило времени, чтобы:
- хорошо оформить основной ноутбук с моделями вообще и на каггл (работа строилась на разных кернелах, которые запускались в фоновом решиме, когда освобождалась сессия с GPU предыдущего. Потом приходилось перекидывать код из тех кернелов в этот (основной) и сращивать его, а это оказалось трудоемкой операцией, так как работая в тестовых кернелах я не думал о последующей переброске и менял наборы признаков, гиперпараметры, многое в общем без какой-либо системы)
- проанализировать где ошибается модель
- в ручную собрать тест, чтобы учесть несбалансированные гибриды и электрокары или отдельно обучить на них модели и сделать блендинг
- составить таблицу с результатами экспериментов как это было в предыдущем проекте
- перебрать все варианты комбинаций признаков для оптимального набора для catboost  
:arrow_up:[к оглавлению](https://github.com/alex-sokolov2011/skillfactory_rds/blob/master/module_7/README.md#Оглавление)

Если информация по этому проекту покажется вам интересной или полезной, то я буду очень вам благодарен, если отметите репозиторий и профиль ⭐️⭐️⭐️-дами